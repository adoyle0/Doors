#!/bin/sh
set -e

# Install yay
cd
if [ ! "$(command -v yay)" ]; then

    echo "Yay not found, installing..."

    if test -d yay; then
        rm -rf yay
    fi

    git clone https://aur.archlinux.org/yay.git
    cd yay
    makepkg -si --noconfirm
    cd
    rm -rf yay
else
    printf  "\nYay is already installed, skipping..."
fi

# Install base shell
if [ "$1" -ge 1 ]; then

    printf "\nInstalling base shell..."
    yay -S --needed --noconfirm \
        atool \
        archlinux-contrib \
        bat \
        btop \
        byobu \
        coreutils \
        fd \
        fzf \
        glow \
        go \
        man-db \
        man-pages \
        mosh \
        neovim \
        nnn \
        npm \
        oh-my-zsh-git \
        pacman-contrib \
        rate-mirrors \
        ripgrep \
        rsync \
        rubygems \
        sl \
        tar \
        tree \
        unrar \
        unzip \
        wget \
        zsh

    cargo install leptosfmt
fi

# Install basic GUI
if [ "$1" -ge 2 ]; then

    printf "\nInstalling basic GUI..."
    yay -S --needed --noconfirm \
        acpi \
        alacritty \
        arandr \
        awesome \
        bluez \
        chromium \
        gnome-themes-extra \
        librewolf-bin \
        maim \
        noto-fonts \
        noto-fonts-cjk \
        noto-fonts-emoji \
        nsxiv \
        otf-commit-mono-nerd \
        otf-font-awesome \
        picom \
        playerctl \
        polkit-gnome \
        python-pywalfox-librewolf \
        redshift \
        unclutter \
        wallust \
        xclip \
        xorg-server \
        xorg-xinit \
        xorg-xrandr \
        xwallpaper

    # Init and update awesome widgets submodule
    cd "$HOME"/.doors &&
    git submodule init && git submodule update

    # Set up pywalfox
    if ! test -f "$HOME"/.librewolf/native-messaging-hosts/pywalfox.json; then
        pywalfox install --browser librewolf
    fi

    # Copy default wallpaper and set colors
    if ! test -f "$HOME"/Pictures/Wallpapers/door2.jpg; then
        if ! test -d "$HOME"/Pictures/Wallpapers; then
            mkdir -p "$HOME"/Pictures/Wallpapers
            printf "Downloading default wallpaper...\n"
            curl -so "$HOME"/Pictures/Wallpapers/door2.jpg https://old.doordesk.net/door2.jpg &&
            wallust run -qs "$HOME"/Pictures/Wallpapers/door2.jpg
        fi
    fi
fi

# Install extras
if [ "$1" -ge 3 ]; then

    printf "\nInstalling extras..."
    yay -S --needed --noconfirm \
        caprine-bin \
        discord \
        gimp \
        spotify-launcher \
        steam \
        telegram-desktop \
        thunderbird \
        walogram-git
fi

echo "Updating nnn plugins..."
sh -c "$(curl -Ls https://raw.githubusercontent.com/jarun/nnn/master/plugins/getplugs)"

# Set shell
echo ""
if [ "$SHELL" = "/bin/zsh" ]; then
    echo "Shell already set to zsh"
else
    sudo chsh -s /bin/zsh "$USER"
    printf "\nLog out and back in for changes to take effect.\n"
fi
