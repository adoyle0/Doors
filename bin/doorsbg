#!/bin/sh
set -e

# Ensure output dir exists
if ! test -d "$HOME"/.cache/wal; then
    mkdir "$HOME"/.cache/wal
fi

# Pick a random wallpaper and generate colors
cd ~/Pictures/Wallpapers/ &&
find . |sort -R |tail -1 |while read -r file; do
    wallust run -qs "$file"
done

# Use the new colors
[ -x "$(command -v walogram )" ] && walogram -B &&
# Hack because walogram has a bug with hot-reload
cp ~/.cache/walogram/wal.tdesktop-theme ~/.cache/walogram/doors.tdesktop-theme
[ -x "$(command -v pywalfox)" ] && pywalfox update
xrdb -merge -quiet ~/.cache/wal/colors.Xresources
